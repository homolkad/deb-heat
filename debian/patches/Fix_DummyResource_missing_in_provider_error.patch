Description: Fix `DummyResource missing in provider` error
Author: Rabi Mishra <ramishra@redhat.com>
Date: Wed, 29 Jul 2015 03:33:19 +0000 (+0530)
X-Git-Url: https://review.openstack.org/gitweb?p=openstack%2Fheat.git;a=commitdiff_plain;h=c6c1cc9e8ad68c431debfa92cdf2d2b9aca53804
Change-Id: Ie1144702b9a6c008889116b408b4b09c3087d73e
Bug-Ubuntu: https://bugs.launchpad.net/heat/+bug/1479185
Origin: upstream, https://review.openstack.org/#/c/206862/
Last-Update: 2015-08-03

diff --git a/heat/tests/test_provider_template.py b/heat/tests/test_provider_template.py
index f883c0b..1394750 100644
--- a/heat/tests/test_provider_template.py
+++ b/heat/tests/test_provider_template.py
@@ -279,12 +279,19 @@ class ProviderTemplateTest(common.HeatTestCase):
         provider = {
             'HeatTemplateFormatVersion': '2012-12-12',
             'Outputs': {
-                'Blarg': {'Value': 'wibble'},
+                'Foo': {'Value': 'bar'},
             },
         }
         files = {'test_resource.template': json.dumps(provider)}
 
+        class DummyResource(object):
+            support_status = support.SupportStatus()
+            properties_schema = {}
+            attributes_schema = {"Foo": attributes.Schema(
+                "A test attribute")}
+
         env = environment.Environment()
+        resource._register_class('DummyResource', DummyResource)
         env.load({'resource_registry':
                   {'DummyResource': 'test_resource.template'}})
         stack = parser.Stack(utils.dummy_context(), 'test_stack',
@@ -298,12 +305,12 @@ class ProviderTemplateTest(common.HeatTestCase):
                                                       definition, stack)
         self.assertIsNone(temp_res.validate())
         nested = mock.Mock()
-        nested.outputs = {'Blarg': {'Value': 'not-this',
-                                    'error_msg': 'it is all bad'}}
+        nested.outputs = {'Foo': {'Value': 'not-this',
+                                  'error_msg': 'it is all bad'}}
         nested.output.return_value = None
         temp_res._nested = nested
         self.assertRaises(exception.InvalidTemplateAttribute,
-                          temp_res.FnGetAtt, 'Blarg')
+                          temp_res.FnGetAtt, 'Foo')
 
     def test_properties_normal(self):
         provider = {
